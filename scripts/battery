#!/bin/bash

LOCKFILE="/tmp/battery-monitor.lock"

exec 9>"$LOCKFILE" || exit 1
flock -n 9 || exit 0

export DISPLAY=:0

while true; do
	battery_level=$(cat /sys/class/power_supply/BAT0/capacity)
	charging_status=$(cat /sys/class/power_supply/BAT0/status)

	if [ "$charging_status" = "Discharging" ] && [ "$battery_level" -le 20 ]; then
		notify-send --urgency=critical --expire-time=10000 \
			"Low Battery!" "Battery level is ${battery_level}%"
	fi

	sleep 300
done
